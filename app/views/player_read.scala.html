@(player: models.Player)
@import play.i18n._

@gameLine(score: models.Score) = {
    <tr>
        <td style="vertical-align: middle;">
            <a href="@routes.GameController.indexWithName(score.game, score.game.getEscapedTitle)">@score.game.title</a>
        </td>
        <td style="vertical-align: middle;">
            @if(score.mode != null) {
                <span class="label label-default" style="vertical-align: middle; line-height: 30px;">@score.mode.name.toUpperCase</span>
            }
            @if(score.difficulty != null) {
                <span class="label label-warning" style="line-height: 20px;">@score.difficulty.name.toUpperCase</span>
            }
        </td>
        <td style="vertical-align: middle; text-align: right;">
            @score.stage
        </td>
        <td style="text-align: right; vertical-align: middle;">
            <a href="@routes.ScoreController.read(score)">@score.formattedValue</a>
        </td>
        <td style="text-align: right; vertical-align: middle">
            @if(player.isVip) {
                @score.formattedRank
            } else {
                VIP Only
            }
        </td>
        <td style="text-align: right; vertical-align: middle">
            @score.rank
        </td>
        <td style="text-align: right; vertical-align: middle">
            @score.value
        </td>
    </tr>
}
@main() {
    <script src="http://code.highcharts.com/highcharts.js"></script>
    <script src="http://code.highcharts.com/modules/exporting.js"></script>

    <h2>
        @player.name
    </h2>

    @if(actions.User.current.isAuthenticated) {
        <p>
            <a href="@routes.VersusController.index(actions.User.current(), player)" class="btn btn-default btn-xs">
                <span class="glyphicon glyphicon-transfer"></span> Comparer nos scores
            </a>
        </p>
    }

    <div class="row">
        <div class="col-md-4">
            <h3>10 derniers scores</h3>
            <table class="table table-condensed table-striped table-hover table-bordered">
                <thead>
                    <th>Jeu</th>
                    <th>Date</th>
                </thead>
                @for(score <- player.scores.toSeq.sortBy(-_.getCreatedAt.getTime).take(10)) {
                    <tr>
                        <td>
                            <a href="@routes.GameController.indexWithName(score.game, score.game.getEscapedTitle)">@score.game.title</a>
                        </td>
                        <td>@score.formattedDate</td>
                    </tr>
                }
            </table>
        </div>
        <div class="col-md-4">
            <h3>10 plateformes préférées</h3>
            <table class="table table-condensed table-striped table-hover table-bordered">
                <thead>
                    <th>Plateforme</th>
                    <th>#</th>
                </thead>
                @for(pair <- player.scores.filter(_.platform != null).groupBy(_.platform.name.toUpperCase).mapValues(_.size).toSeq.sortBy(-_._2).take(10)) {
                    <tr>
                        <td><a href="@routes.PlatformController.read(pair._1)">@pair._1</a></td>
                        <td>@pair._2</td>
                    </tr>
                }
            </table>
        </div>
        <div class="col-md-4">
            <h3>Palmarès <img style="position : absolute; right: 10px;" src="@routes.PlayerController.medalsWhite(player.shmupUserId)" /></h3>
            <table class="table table-condensed table-striped table-hover table-bordered">
                <thead>
                    <th>Rang</th>
                    <th>#</th>
                </thead>
                @defining(player.computeCounts) { counts =>
                    <tr><td>1st</td><td>@counts.firstRankCount</td></tr>
                    <tr><td>2nd</td><td>@counts.secondRankCount</td></tr>
                    <tr><td>3rd</td><td>@counts.thirdRankCount</td></tr>
                    <tr><td>1CC</td><td>@counts.oneCreditCount</td></tr>
                }
            </table>
        </div>
    </div>

    <h3>Scores</h3>

   <table id="scores" class="table table-condensed table-striped table-hover table-bordered">
       <thead>
           <th>@Messages.get("Game")</th>
           <th style="text-align: center">@Messages.get("Mode") / @Messages.get("Difficulty")</th>
           <th style="text-align: center">@Messages.get("Stage")</th>
           <th style="text-align: center">@Messages.get("Score")</th>
           <th style="text-align: center">@Messages.get("Rank")</th>
           <th></th>
           <th></th>
       </thead>
       @player.bestScores.map(gameLine(_))
   </table>

    <script>
    $(document).ready(function() {
        $('#scores').dataTable({
        "bJQueryUI": true,
        "sDom": "<'row dataTables_utils'<'col-md-6'l><'col-md-6'f>r>t<'row dataTables_utils'<'col-md-6'i><'col-md-6'p>>",
        "bPaginate": false,
        "bLengthChange": false,
        "bInfo": false,
        "aoColumnDefs": [
            { "iDataSort": 6, "aTargets": [3] },
            { "iDataSort": 5, "aTargets": [4] },
            { "bVisible": false, "aTargets": [5] },
            { "bVisible": false, "aTargets": [6] }
        ]
        });
        });
    </script>

    @if(player.hasReplays) {
        <h3>@Messages.get("Replays")</h3>
        <table class="table table-condensed table-striped table-hover table-bordered">
        @for(score <- player.bestReplayableScores) {
            <tr>
                <td style="width: 50px; text-align: center; vertical-align: middle;">
                    <a href="@score.replay" target="_blank" class="label label-primary">
                        <span class="glyphicon glyphicon-play"></span>
                    </a>
                </td>
                <td>
                    <a href="@routes.GameController.indexWithName(score.game, score.game.getEscapedTitle)">@score.game.title</a>
                </td>
                <td>
                    <span class="label label-default" style="vertical-align: middle;">@score.mode</span>
                    <span class="label label-warning">@score.difficulty</span>
                    <span class="label label-success">
                        @if(score.platform != null) {
                            <a class="platform" href="@routes.PlatformController.read(score.platform.name.toUpperCase)">@score.platform.name.toUpperCase</a>
                        }
                    </span>
                </td>
                <td style="text-align: right;"><a href="@routes.ScoreController.read(score)">@score.formattedValue</a></td>
                <td style="text-align: right;">@score.formattedDate</td>
            </tr>
        }
        </table>
    }
}
